window.currentLang = 'ko';

window.i18n = {
    ko: {
        nav: { vs: "ğŸ“Š VS ëŒ€ê²°", growth: "ğŸ“ˆ ì„±ì¥ ê³„ì‚°ê¸°", board: "ğŸ’¡ ì •ë³´ ê³µìœ " },
        targets: { t6: "6ìƒ", t8: "8ìƒ", t9: "9ìƒ" },
        fixed: "ì¼ì¼ ê³ ì • íšë“ëŸ‰", reset: "ì´ˆê¸°í™”",
        result: { score: "SCORE", box: "BOX", remain: "ë‚¨ì€ ì ìˆ˜" },
        modal: { tech: "ì—°ë§¹ í…Œí¬ ì„¤ì •", spd: "ê°€ì† ì‹œê°„ ê³„ì‚°", drone: "ë“œë¡  íŒŒì¸  ìƒì", hero: "ì˜ì›… ì¡°ê°", btn_close: "ë‹«ê¸°", btn_apply: "ì ìš©", btn_cancel: "ì·¨ì†Œ", btn_open: "ì…ë ¥í•˜ê¸°", btn_confirm: "í™•ì¸", total: "ì´", weekly: "ì´ë²ˆ ì£¼ ëŒ€ê²° ë¦¬í¬íŠ¸ ğŸ“ˆ" },
        units: { day: "ì¼", hour: "ì‹œ", min: "ë¶„" },
        expert: "ğŸ† ëŒ€ê²° ì „ë¬¸ê°€", radar: "ğŸ“¡ ì¶”ë‹¹-ë ˆì´ë”", spd: "â±ï¸ ì¶”ë‹¹-ê°€ì†", tech_rec: "ğŸ« ì¶”ë‹¹-ëª¨ì§‘", con: "ğŸ° ì¶”ë‹¹-ê±´ì„¤", tec: "ğŸ”¬ ì¶”ë‹¹-í…Œí¬", trn: "âš”ï¸ ì¶”ë‹¹-í›ˆë ¨", kil: "ğŸ”¥ ì¶”ë‹¹-ì ì²˜ì¹˜",
        days: ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "],
        success: "ğŸ‰ ëª©í‘œ ë‹¬ì„±! ì™„ë²½í•©ë‹ˆë‹¤!",
        labels: { m5: "5ë¶„", m15: "15ë¶„", h1: "1ì‹œê°„", h3: "3ì‹œê°„", h8: "8ì‹œê°„", ur: "UR ì¡°ê°", ssr: "SSR ì¡°ê°", sr: "SR ì¡°ê°" },
        inputs: { squads: "ğŸšœ ì±„ì§‘ ë¶€ëŒ€ ìˆ˜", squads_unit: "ë¶€ëŒ€", gather: "â±ï¸ ì‹œê°„ë‹¹ ì±„ì§‘(h)", dia: "ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤", radar_task: "ğŸ“¡ ë ˆì´ë” ì„ë¬´", stam: "âš¡ ì²´ë ¥ ì†Œëª¨", exp: "â­ ì˜ì›… ê²½í—˜ì¹˜(1M)", part: "âš™ï¸ ë“œë¡  ë¶€í’ˆ", data: "ğŸ’¾ ë“œë¡  ë°ì´í„°(1k)", truck: "ğŸšš UR í™”ë¬¼ì°¨", sec: "ğŸ•µï¸ UR ì€ë°€ ì„ë¬´", surv: "ğŸ« ìƒì¡´ì ëª¨ì§‘", build_spd: "â±ï¸ ê±´ì„¤ ê°€ì†(h)", pow_con: "ğŸ° ê±´ë¬¼ ì „íˆ¬ë ¥(1k)", tec_spd: "â±ï¸ í…Œí¬ ê°€ì†(h)", pow_tec: "ğŸ”¬ í…Œí¬ ì „íˆ¬ë ¥(1k)", medal: "ğŸ… ëª…ì˜ˆ í›ˆì¥ ì†Œëª¨", tkt: "ğŸ« ì˜ì›… ëª¨ì§‘", sk: "ğŸ… ìŠ¤í‚¬ í›ˆì¥", trn_spd: "â±ï¸ í›ˆë ¨ ê°€ì†(h)", trn_cnt: "âš”ï¸ í›ˆë ¨ ìˆ˜", trn_lvl: "ğŸ¯ í›ˆë ¨ ë ˆë²¨", kill_spd: "â±ï¸ ëª¨ë“  ê°€ì†(h)", kill_target: "âš”ï¸ ì²˜ì¹˜ ëŒ€ìƒ", kill_lvl: "ğŸ¯ ì²˜ì¹˜ ë ˆë²¨", kill_cnt: "ğŸ”¥ ì²˜ì¹˜ ìˆ˜", dth_lvl: "ğŸ’€ ì „ì‚¬ ë ˆë²¨", dth_cnt: "ğŸ©¸ ì „ì‚¬ ìˆ˜", target_spec: "íŠ¹ì • ë§¤ì¹­ ì—°ë§¹", target_gen: "ì¼ë°˜ ì êµ°" },
        rec: { success: "ëª©í‘œë¥¼ ë„‰ë„‰í•˜ê²Œ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒì„ ìœ„í•´ ìì›ì„ ì•„ë¼ì„¸ìš”.", guide_title: "ë‹¬ì„± ê°€ì´ë“œ", desc: "ë‚¨ì€ ì ìˆ˜ë¥¼ ì±„ìš°ê¸° ìœ„í•´ ë‘ ìì›ì˜ ë¹„ìœ¨ì„ ì¡°ì ˆí•´ë³´ì„¸ìš”.", single_desc: "ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ë‹¤ìŒ í•­ëª©ì˜ ìˆ˜ëŸ‰ì´ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤.", count: "ê°œ", target_goal: "ëª©í‘œ" },
        menu: { tech_title: "ì—°ë§¹ í…Œí¬ ì„¤ì •", tech_desc: "ê°œì¸ë³„ í…Œí¬ ë ˆë²¨ ë°˜ì˜", skill_title: "ìŠ¤í‚¬ í›ˆì¥ ê³„ì‚°", skill_desc: "ë…ë¦½í˜• í›ˆì¥ ì‹œë®¬ë ˆì´í„°" },
        btn: { quick: "âš¡ ì¾Œì†", quick_title: "ì¾Œì† ì…ë ¥", quick_bg: "ğŸ“· ì¸ë²¤í† ë¦¬ ìŠ¤í¬ë¦°ìƒ· ë¶ˆëŸ¬ì˜¤ê¸°", quick_apply: "ì¼ê´„ ì ìš©" },
        skill: { title: "ğŸ… ì˜ì›… ìŠ¤í‚¬ í›ˆì¥ ê³„ì‚°ê¸°", ur: "UR ì˜ì›…", ssr: "SSR ì˜ì›…", sr: "SR ì˜ì›…", cur: "í˜„ì¬", tgt: "ëª©í‘œ", total: "ì´ í•„ìš” í›ˆì¥", bg_change: "ğŸ“· ë°°ê²½ ë³€ê²½", bg_reset: "ğŸ—‘ï¸ ì´ˆê¸°í™”", pos1: "1ìŠ¤í‚¬ (ì¢Œìƒ)", pos2: "2ìŠ¤í‚¬ (ìš°ìƒ)", pos3: "3ìŠ¤í‚¬ (ì¢Œí•˜)", pos4: "4ìŠ¤í‚¬ (ìš°í•˜)", k_unit: "k" },
        growth: { 
            tab_skill: "ğŸ… ìŠ¤í‚¬ í›ˆì¥", tab_gear: "âš™ï¸ ì¥ë¹„ ê°•í™”", tab_valor: "ğŸ”¬ í…Œí¬ ì—°êµ¬",
            gear_gun: "ğŸ”« ë ˆì¼ê±´", gear_armor: "ğŸ›¡ï¸ ì¥ê°‘", gear_radar: "ğŸ“¡ ë ˆì´ë”", gear_chip: "ğŸ’¾ ì¹©",
            res_gold: "ê¸ˆí™”", res_ore: "ê°•í™”ì„", res_cer: "ìœ ì „ì²´ ì„¸ë¼ë¯¹", res_bp: "ì¥ë¹„ ë„ë©´(UR)", res_mbp: "ì¥ë¹„ ë„ë©´(ì‹ í™”)",
            cur_tier: "í˜„ì¬ ë“±ê¸‰", tgt_tier: "ëª©í‘œ ë“±ê¸‰", tot_res: "ì´ í•„ìš” ìì›",
            cat_vs: "Alliance Duel (VS ëŒ€ê²°)", cat_truck: "Intercity Truck (ë„ì‹œ ê°„ í™”ë¬¼ì°¨)", cat_sf: "Special Forces (íŠ¹ìˆ˜ ë¶€ëŒ€)",
            valor_notice: "* ê° ì—°êµ¬ì˜ í˜„ì¬/ëª©í‘œ ë ˆë²¨ì„ ì§€ì •í•˜ë©´ í•„ìš”í•œ ì´ <b>Valor ê°œìˆ˜</b>ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.",
            valor_warn: "â€» AI ì•ˆë‚´: ë°©ëŒ€í•œ ë‚´ë¶€ ìˆ˜ì¹˜ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ì–´ ê³„ì‚°ê¸° êµ¬ì¡°ë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤. js/growth.js ë‚´ë¶€ì˜ VALOR_DATA ë¶€ë¶„ì— ì‹¤ì œ ìˆ˜ì¹˜ë¥¼ ì¶”ê°€í•˜ì‹œë©´ ì™„ë²½í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤!",
            tot_valor: "ì´ í•„ìš” ë°œëŸ¬ (Valor Badge)"
        }
    },
    en: {
        nav: { vs: "ğŸ“Š VS Duel", growth: "ğŸ“ˆ Growth Calc", board: "ğŸ’¡ Info Share" },
        targets: { t6: "6 Boxes", t8: "8 Boxes", t9: "9 Boxes" },
        fixed: "Daily Fixed Income", reset: "Reset",
        result: { score: "SCORE", box: "BOX", remain: "Remaining" },
        modal: { tech: "Alliance Tech", spd: "Speedup Calc", drone: "Drone Box", hero: "Hero Shards", btn_close: "Close", btn_apply: "Apply", btn_cancel: "Cancel", btn_open: "Input", btn_confirm: "Confirm", total: "Total", weekly: "Weekly Report ğŸ“ˆ" },
        units: { day: "d", hour: "h", min: "m" },
        expert: "ğŸ† VS Expert", radar: "ğŸ“¡ Radar", spd: "â±ï¸ Speedup", tech_rec: "ğŸ« Recruit Bonus", con: "ğŸ° Build", tec: "ğŸ”¬ Tech", trn: "âš”ï¸ Train", kil: "ğŸ”¥ Kill",
        days: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
        success: "ğŸ‰ Target Achieved!",
        labels: { m5: "5m", m15: "15m", h1: "1h", h3: "3h", h8: "8h", ur: "UR Shard", ssr: "SSR Shard", sr: "SR Shard" },
        inputs: { squads: "ğŸšœ Gathering Squads", squads_unit: "", gather: "â±ï¸ Gather (h)", dia: "ğŸ’ Buy Diamonds", radar_task: "ğŸ“¡ Radar Tasks", stam: "âš¡ Consume Stamina", exp: "â­ Hero EXP (1M)", part: "âš™ï¸ Drone Parts", data: "ğŸ’¾ Drone Data (1k)", truck: "ğŸšš UR Truck", sec: "ğŸ•µï¸ UR Secret Task", surv: "ğŸ« Recruit Survivors", build_spd: "â±ï¸ Build Speedup (h)", pow_con: "ğŸ° Build Power (1k)", tec_spd: "â±ï¸ Tech Speedup (h)", pow_tec: "ğŸ”¬ Tech Power (1k)", medal: "ğŸ… Honor Medal", tkt: "ğŸ« Hero Ticket", sk: "ğŸ… Skill Medal", trn_spd: "â±ï¸ Train Speedup (h)", trn_cnt: "âš”ï¸ Train Troops", trn_lvl: "ğŸ¯ Train Level", kill_spd: "â±ï¸ All Speedups (h)", kill_target: "âš”ï¸ Kill Target", kill_lvl: "ğŸ¯ Kill Level", kill_cnt: "ğŸ”¥ Kill Count", dth_lvl: "ğŸ’€ Death Level", dth_cnt: "ğŸ©¸ Death Count", target_spec: "Matched Alliance", target_gen: "General Enemy" },
        rec: { success: "Target achieved! Save your resources.", guide_title: "Guide", desc: "Adjust the slider to distribute resources.", single_desc: "The following amount is needed to reach your target.", count: "", target_goal: "Target" },
        menu: { tech_title: "Alliance Tech", tech_desc: "Apply personal tech levels", skill_title: "Skill Medal Calc", skill_desc: "Independent simulator" },
        btn: { quick: "âš¡ Quick", quick_title: "Quick Input", quick_bg: "ğŸ“· Load Inventory Screenshot", quick_apply: "Apply All" },
        skill: { title: "ğŸ… Skill Medal Calculator", ur: "UR Hero", ssr: "SSR Hero", sr: "SR Hero", cur: "Current", tgt: "Target", total: "Total Medals", bg_change: "ğŸ“· Change BG", bg_reset: "ğŸ—‘ï¸ Reset", pos1: "Skill 1 (TL)", pos2: "Skill 2 (TR)", pos3: "Skill 3 (BL)", pos4: "Skill 4 (BR)", k_unit: "k" },
        growth: {
            tab_skill: "ğŸ… Skill Medals", tab_gear: "âš™ï¸ Gear Upgrade", tab_valor: "ğŸ”¬ Tech Valor",
            gear_gun: "ğŸ”« Railgun", gear_armor: "ğŸ›¡ï¸ Armor", gear_radar: "ğŸ“¡ Radar", gear_chip: "ğŸ’¾ Chip",
            res_gold: "Gold", res_ore: "Ore", res_cer: "Ceramic", res_bp: "UR Blueprint", res_mbp: "Mythic Blueprint",
            cur_tier: "Current Tier", tgt_tier: "Target Tier", tot_res: "Total Resources Needed",
            cat_vs: "Alliance Duel", cat_truck: "Intercity Truck", cat_sf: "Special Forces",
            valor_notice: "* Set current/target levels to calculate total <b>Valor Badges</b> needed.",
            valor_warn: "â€» AI Note: Added the structure since private DB fetch is limited. Add actual values to VALOR_DATA in js/growth.js!",
            tot_valor: "Total Valor Badges"
        }
    }
};

window.updateUITexts = function() {
    const t = window.i18n[window.currentLang];
    
    const elVs = document.getElementById('nav-vs'); if(elVs) elVs.innerText = t.nav.vs;
    const elGrowth = document.getElementById('nav-growth'); if(elGrowth) elGrowth.innerText = t.nav.growth;
    const elBoard = document.getElementById('nav-board'); if(elBoard) elBoard.innerText = t.nav.board;
    
    const elTabSkill = document.getElementById('tab-skill'); if(elTabSkill) elTabSkill.innerText = t.growth.tab_skill;
    const elTabGear = document.getElementById('tab-gear'); if(elTabGear) elTabGear.innerText = t.growth.tab_gear;
    const elTabValor = document.getElementById('tab-valor'); if(elTabValor) elTabValor.innerText = t.growth.tab_valor;

    const map = {
        'menu-tech-title': t.menu.tech_title, 'menu-tech-desc': t.menu.tech_desc,
        'tech-title': `ğŸ”¬ ${t.menu.tech_title.toUpperCase()}`, 'tech-open-btn': t.modal.btn_open,
        'tech-modal-title': t.menu.tech_title, 'tech-confirm-btn': t.modal.btn_confirm,
        'drone-modal-title': t.modal.drone, 'drone-confirm-btn': t.modal.btn_confirm,
        'hero-modal-title': t.modal.hero, 'hero-confirm-btn': t.modal.btn_confirm,
        'weekly-modal-title': t.modal.weekly, 'weekly-close-btn': t.modal.btn_close,
        'spd-cancel-btn': t.modal.btn_cancel, 'spd-apply-btn': t.modal.btn_apply,
        'quick-modal-title': t.btn.quick_title, 'quick-bg-btn': t.btn.quick_bg,
        'quick-cancel-btn': t.modal.btn_cancel, 'quick-apply-btn': t.btn.quick_apply,
    };
    Object.keys(map).forEach(id => { const el = document.getElementById(id); if(el) el.innerText = map[id]; });
    
    const t6El = document.getElementById('target-2300000'); if (t6El) t6El.innerHTML = `${t.targets.t6}<br><span class="target-medal">ğŸ… 400</span>`;
    const t8El = document.getElementById('target-3600000'); if (t8El) t8El.innerHTML = `${t.targets.t8}<br><span class="target-medal">ğŸ… 800</span>`;
    const t9El = document.getElementById('target-7200000'); if (t9El) t9El.innerHTML = `${t.targets.t9}<br><span class="target-medal">ğŸ… 1,200</span>`;

    const dayTabs = document.getElementById('day-tabs-container');
    if(dayTabs) { dayTabs.innerHTML = ['mon','tue','wed','thu','fri','sat'].map((d, i) => `<button id="btn-${d}" class="day-btn ${d===window.currentDay?'active':''}" style="background:var(--${d})" onclick="window.switchTab('${d}')">${t.days[i]}</button>`).join(''); }

    if(window.renderTechInputs) window.renderTechInputs(); 
    if(window.renderHeroInputs) window.renderHeroInputs(); 
    if(window.renderInputs) window.renderInputs(); 
    
    const growthSkill = document.getElementById('growth-skill');
    if(growthSkill && growthSkill.classList.contains('active') && window.renderSkillRows) window.renderSkillRows();
    const growthGear = document.getElementById('growth-gear');
    if(growthGear && growthGear.classList.contains('active') && window.renderGearUI) window.renderGearUI();
    const growthValor = document.getElementById('growth-valor');
    if(growthValor && growthValor.classList.contains('active') && window.renderValorUI) window.renderValorUI();
}

window.changeLang = function(lang) { 
    window.currentLang = lang; 
    document.getElementById('lang-ko').classList.toggle('active', lang === 'ko'); 
    document.getElementById('lang-en').classList.toggle('active', lang === 'en'); 
    const recBox = document.getElementById('recommend-box'); 
    if(recBox) { recBox.removeAttribute('data-rendered-day'); recBox.removeAttribute('data-rendered-lang'); } 
    window.updateUITexts(); 
    if(window.updateAll) window.updateAll();
};