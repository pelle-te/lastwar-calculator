<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¼ìŠ¤íŠ¸ ì›Œ VS ë§ˆìŠ¤í„° v7.2 (LIVE)</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4f46e5; --mon: #3b82f6; --tue: #f59e0b; --wed: #8b5cf6;
            --thu: #ef4444; --fri: #10b981; --sat: #b91c1c; --bg: #f1f5f9;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #1e293b; overflow-x: hidden; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-bar { background: #1e293b; display: flex; position: sticky; top: 0; z-index: 1000; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .nav-item { flex: 1; padding: 12px 0; text-align: center; color: #94a3b8; font-weight: 800; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .nav-item.active { color: white; border-bottom: 3px solid var(--primary); }

        .page-content { display: none; padding: 15px; padding-bottom: 160px; animation: fadeIn 0.3s ease; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; border-radius: 20px; padding: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .section-title { font-size: 1rem; font-weight: 800; margin-bottom: 15px; color: var(--primary); display: flex; align-items: center; gap: 8px; }

        /* ëª©í‘œ ì„¤ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³´ì • */
        .target-btn { flex: 1; padding: 10px; border-radius: 10px; border: 2px solid #ddd; background: white; color: #64748b; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .target-btn.active { border-color: var(--primary); background: #eef2ff; color: var(--primary); }

        /* í…Œí¬ ë° ìš”ì¼ íƒ­ */
        .tech-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .tech-item { background: #f8fafc; padding: 10px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .tech-item label { font-size: 0.7rem; color: #64748b; display: block; margin-bottom: 4px; }
        .tech-item select { width: 100%; border: none; background: transparent; font-weight: 800; color: var(--primary); outline: none; font-size: 0.85rem; }
        .day-tabs { display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; margin: 15px 0; }
        .day-btn { padding: 10px 0; border-radius: 10px; border: none; color: white; font-weight: 800; opacity: 0.3; font-size: 0.8rem; cursor: pointer; }
        .day-btn.active { opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* ê²Œì‹œíŒ UI ë° ì‚­ì œ ë²„íŠ¼ */
        .post-textarea { width: 100%; height: 100px; border: 1px solid #ddd; border-radius: 12px; padding: 12px; box-sizing: border-box; font-size: 0.95rem; margin-bottom: 10px; outline: var(--primary); resize: none; }
        .post-item { background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; margin-bottom: 12px; position: relative; }
        .post-time { font-size: 0.75rem; color: #94a3b8; margin-bottom: 6px; }
        .post-img { width: 100%; border-radius: 10px; margin-top: 10px; display: block; }
        .del-btn { position: absolute; top: 12px; right: 12px; background: #fee2e2; color: #ef4444; border: none; border-radius: 6px; padding: 4px 8px; font-size: 0.7rem; font-weight: 800; cursor: pointer; }

        /* í•˜ë‹¨ ê²°ê³¼ë°” */
        .result-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; color: white; padding: 20px; border-radius: 25px 25px 0 0; text-align: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); z-index: 2000; }
        .total-score { font-size: 1.8rem; font-weight: 900; color: #fbbf24; }
        .progress-container { height: 10px; background: #334155; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #10b981); width: 0%; transition: 0.5s; }
    </style>
</head>
<body>

<nav class="nav-bar">
    <div id="nav-calc" class="nav-item active" onclick="showPage('calc')">ğŸ“Š ê³„ì‚°ê¸°</div>
    <div id="nav-board" class="nav-item" onclick="showPage('board')">ğŸ“– ê³µëµ ê³µìœ </div>
    <div id="nav-qna" class="nav-item" onclick="showPage('qna')">ğŸ’¬ ê±´ì˜ ì‚¬í•­</div>
</nav>

<div class="container">
    <div id="page-calc" class="page-content active">
        <div class="card">
            <div class="section-title">ğŸ¯ ëª©í‘œ ì„¤ì •</div>
            <div style="display:flex; gap:6px;">
                <button class="target-btn" id="t-2300000" onclick="setTarget(2300000)">6ìƒ</button>
                <button class="target-btn" id="t-3600000" onclick="setTarget(3600000)">8ìƒ</button>
                <button class="target-btn active" id="t-7200000" onclick="setTarget(7200000)">9ìƒ</button>
            </div>
        </div>
        <div class="card">
            <div class="section-title">ğŸ”¬ í…Œí¬ í˜„í™©</div>
            <div class="tech-grid" id="tech-inputs"></div>
        </div>
        <div class="day-tabs">
            <button id="btn-mon" class="day-btn active" style="background:var(--mon)" onclick="switchTab('mon')">ì›”</button>
            <button id="btn-tue" class="day-btn" style="background:var(--tue)" onclick="switchTab('tue')">í™”</button>
            <button id="btn-wed" class="day-btn" style="background:var(--wed)" onclick="switchTab('wed')">ìˆ˜</button>
            <button id="btn-thu" class="day-btn" style="background:var(--thu)" onclick="switchTab('thu')">ëª©</button>
            <button id="btn-fri" class="day-btn" style="background:var(--fri)" onclick="switchTab('fri')">ê¸ˆ</button>
            <button id="btn-sat" class="day-btn" style="background:var(--sat)" onclick="switchTab('sat')">í† </button>
        </div>
        <div class="card" id="input-container"></div>
    </div>

    <div id="page-board" class="page-content">
        <div class="card">
            <div class="section-title">âœï¸ ê³µëµ ê²Œì‹œí•˜ê¸°</div>
            <textarea id="board-text" class="post-textarea" placeholder="ê¿€íŒì„ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            <input type="file" id="board-file" accept="image/*" style="display:none;" onchange="updateFileName('board')">
            <div style="display:flex; gap:8px;">
                <button onclick="document.getElementById('board-file').click()" style="flex:1; padding:12px; border-radius:12px; border:1px solid #ddd; font-weight:800; cursor:pointer;">ğŸ“¸ ì‚¬ì§„ ì²¨ name</button>
                <button onclick="sendLivePost('posts')" style="flex:2; background:var(--primary); color:white; border:none; border-radius:12px; font-weight:800; cursor:pointer;">ê²Œì‹œí•˜ê¸°</button>
            </div>
            <div id="board-filename" style="font-size:0.7rem; color:var(--primary); margin-top:5px; text-align:center;"></div>
        </div>
        <div id="posts-list"></div>
    </div>

    <div id="page-qna" class="page-content">
        <div class="card">
            <div class="section-title">ğŸ“§ ê±´ì˜ ë° ë¬¸ì˜</div>
            <textarea id="qna-text" class="post-textarea" placeholder="ê°œì„  ì‚¬í•­ì„ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            <button onclick="sendLivePost('suggestions')" style="width:100%; background:#334155; color:white; padding:15px; border:none; border-radius:12px; font-weight:800; cursor:pointer;">ê±´ì˜ ì œì¶œí•˜ê¸°</button>
        </div>
        <div id="suggestions-list"></div>
    </div>
</div>

<div class="result-bar">
    <div class="total-score" id="score">0.0</div>
    <div class="progress-container"><div class="progress-fill" id="bar"></div></div>
    <div id="diff" style="font-size:0.85rem; color:#cbd5e1; font-weight:600;">ë‚¨ì€ ì ìˆ˜: 7,200,000</div>
</div>

<script>
    // --- 1. Firebase & Auth ID ---
    const firebaseConfig = {
        apiKey: "AIzaSyAbGdlE4KnelSrrKGLVaLcM5433ZZILVYE",
        authDomain: "lastwar-530f9.firebaseapp.com",
        projectId: "lastwar-530f9",
        storageBucket: "lastwar-530f9.firebasestorage.app",
        messagingSenderId: "135982056229",
        appId: "1:135982056229:web:92264d4601e5315cdd50cc"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ê¸°ê¸° ê³ ìœ  ID ìƒì„± ë° ê³ ì •
    if(!localStorage.getItem('vs_user_unique_id')) {
        localStorage.setItem('vs_user_unique_id', 'user_' + Math.random().toString(36).substr(2, 11));
    }
    const myId = localStorage.getItem('vs_user_unique_id');

    let currentDay = 'mon', targetScore = 7200000;

    // --- 2. ì´ˆê¸°í™” ë° í˜ì´ì§€ ì „í™˜ ---
    function init() {
        const grid = document.getElementById('tech-inputs');
        const techDefs = [
            { id: 't-expert', label: 'ëŒ€ê²° ì „ë¬¸ê°€', max: 20, def: 20 },
            { id: 't-radar', label: 'ì¶”ë‹¹-ë ˆì´ë”', max: 10, def: 6 },
            { id: 't-spd', label: 'ì¶”ë‹¹-ê°€ì†', max: 10, def: 6 },
            { id: 't-rec', label: 'ì¶”ë‹¹-ëª¨ì§‘', max: 10, def: 6 },
            { id: 't-con', label: 'ì¶”ë‹¹-ê±´ì„¤', max: 10, def: 1 },
            { id: 't-tec', label: 'ì¶”ë‹¹-í…Œí¬', max: 10, def: 1 },
            { id: 't-trn', label: 'ì¶”ë‹¹-í›ˆë ¨', max: 10, def: 6 },
            { id: 't-kil', label: 'ì¶”ë‹¹-ì ì²˜ì¹˜', max: 10, def: 6 }
        ];
        techDefs.forEach(t => {
            grid.innerHTML += `<div class="tech-item"><label>${t.label}</label>
                <select id="${t.id}" onchange="updateAll()">
                ${Array.from({length: t.max+1}, (_, i) => `<option value="${i}" ${i===t.def?'selected':''}>Lv ${i} (+${i*5}%)</option>`).join('')}
                </select></div>`;
        });
        switchTab('mon');
        loadLiveView('posts');
        loadLiveView('suggestions');
    }

    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.getElementById('nav-' + pageId).classList.add('active');
    }

    // --- 3. ëª©í‘œ ì„¤ì • ë¡œì§ ë³´ì • ---
    function setTarget(score) {
        targetScore = score;
        // ëª¨ë“  ëª©í‘œ ë²„íŠ¼ì—ì„œ active ì œê±°
        document.querySelectorAll('.target-btn').forEach(btn => btn.classList.remove('active'));
        // ì„ íƒëœ ì ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ë²„íŠ¼ì— active ì¶”ê°€
        document.getElementById('t-' + score).classList.add('active');
        updateAll();
    }

    // --- 4. ê²Œì‹œíŒ & ì‚­ì œ ë¡œì§ ---
    async function sendLivePost(col) {
        const textElem = document.getElementById(col === 'posts' ? 'board-text' : 'qna-text');
        const fileElem = col === 'posts' ? document.getElementById('board-file') : null;
        const text = textElem.value;
        if(!text.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");

        let imgUrl = "";
        if(fileElem && fileElem.files[0]) {
            imgUrl = await new Promise(res => {
                const r = new FileReader();
                r.onload = e => res(e.target.result);
                r.readAsDataURL(fileElem.files[0]);
            });
        }

        db.collection(col).add({
            authorId: myId,
            content: text,
            image: imgUrl,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            textElem.value = "";
            if(fileElem) { fileElem.value = ""; document.getElementById('board-filename').innerText = ""; }
        });
    }

    function loadLiveView(col) {
        db.collection(col).orderBy("timestamp", "desc").onSnapshot(snap => {
            const list = document.getElementById(col + '-list');
            list.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                const time = data.timestamp ? new Date(data.timestamp.seconds*1000).toLocaleString('ko-KR', {month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'}) : "ë°©ê¸ˆ ì „";
                const isMine = data.authorId === myId;
                list.innerHTML += `
                    <div class="post-item">
                        <div class="post-time">${time}</div>
                        <div style="white-space:pre-wrap;">${data.content}</div>
                        ${data.image ? `<img src="${data.image}" class="post-img">` : ""}
                        ${isMine ? `<button class="del-btn" onclick="deletePost('${col}', '${doc.id}')">ì‚­ì œ</button>` : ""}
                    </div>`;
            });
        });
    }

    function deletePost(col, id) {
        if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) db.collection(col).doc(id).delete();
    }

    function updateFileName(type) {
        const file = document.getElementById(type + '-file').files[0];
        document.getElementById(type + '-filename').innerText = file ? "ì„ íƒë¨: " + file.name : "";
    }

    // --- 5. ê³„ì‚°ê¸° ë¡œì§ (ìƒëµ ì—†ëŠ” í•µì‹¬ ë¡œì§) ---
    const BASE = {
        radar: 10000, truck: 100000, secret: 75000, surv: 1500, spd_min: 50, pow_pt: 10,
        h_gather: 9523.5, drone_part: 2500, drone_data: 3, honor_medal: 300,
        recruit: 1500, ur_shard: 10000, ssr_shard: 3500, sr_shard: 1000, skill_medal: 10, exp_unit: 1.0/660,
        trp: [0, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110],
        kil_spec: [0, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55],
        kil_gen: [0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
        dth: [0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
    };

    function switchTab(day) {
        currentDay = day;
        document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+day).classList.add('active');
        renderInputs();
        updateAll();
    }

    function renderInputs() {
        const container = document.getElementById('input-container');
        let html = `<div class="section-title">ğŸ“Š ${currentDay.toUpperCase()} ì ìˆ˜ ì…ë ¥</div>`;
        const config = {
            mon: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'radar',label:'ğŸ“¡ ë ˆì´ë” ì„ë¬´',max:500},{id:'stam',label:'âš¡ ì²´ë ¥ ì†Œëª¨',max:10000},{id:'exp',label:'â­ ì˜ì›… ê²½í—˜ì¹˜(1M)',max:3000},{id:'part',label:'âš™ï¸ ë“œë¡  ë¶€í’ˆ',max:5000},{id:'data',label:'ğŸ’¾ ë“œë¡  ë°ì´í„°(1k)',max:10000}],
            tue: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'truck',label:'ğŸšš UR í™”ë¬¼ì°¨',max:100},{id:'sec',label:'ğŸ•µï¸ UR ì€ë°€ ì„ë¬´',max:200},{id:'spd',label:'â±ï¸ ê±´ì„¤ ê°€ì†(h)',max:3000}],
            wed: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'radar',label:'ğŸ“¡ ë ˆì´ë” ì„ë¬´',max:500},{id:'spd',label:'â±ï¸ í…Œí¬ ê°€ì†(h)',max:3000}],
            thu: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'tkt',label:'ğŸ« ì˜ì›… ëª¨ì§‘',max:5000},{id:'ur',label:'ğŸ§© UR ì¡°ê°',max:5000},{id:'exp',label:'â­ ì˜ì›… ê²½í—˜ì¹˜(1M)',max:3000}],
            fri: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'radar',label:'ğŸ“¡ ë ˆì´ë” ì„ë¬´',max:500},{id:'spd-trn',label:'â±ï¸ í›ˆë ¨ ê°€ì†(h)',max:2000}],
            sat: [{id:'dia',label:'ğŸ’ ë‹¤ì´ì•„ êµ¬ë§¤',max:100000},{id:'spd-all',label:'â±ï¸ ëª¨ë“  ê°€ì†(h)',max:5000}]
        };
        if(currentDay==='fri'){ html += renderRow('fri','count','âš”ï¸ í›ˆë ¨ ìˆ˜',50000); }
        if(currentDay==='sat'){ html += renderRow('sat','kill','ğŸ”¥ ì²˜ì¹˜ ìˆ˜',200000); html += renderRow('sat','dth','ğŸ©¸ ì „ì‚¬ ìˆ˜',200000); }
        (config[currentDay] || []).forEach(i => html += renderRow(currentDay, i.id, i.label, i.max));
        container.innerHTML = html;
    }

    function renderRow(d, id, l, m) { return `<div class="input-group"><div class="input-row"><label>${l}</label><input type="number" id="${d}-${id}" value="0" min="0" oninput="syncRange('${id}', this.value)"></div><input type="range" id="range-${id}" min="0" max="${m}" value="0" step="1" oninput="syncInput('${id}', this.value)"></div>`; }
    function syncInput(id, v) { document.getElementById(`${currentDay}-${id}`).value = v; updateAll(); }
    function syncRange(id, v) { if(v<0) v=0; let r=document.getElementById('range-'+id); if(r) r.value=v; updateAll(); }
    function val(id) { let el = document.getElementById(id); return el ? parseFloat(el.value) || 0 : 0; }

    function updateAll() {
        const d = currentDay;
        let s = val(d+'-dia') * 30;
        let m = { rad:getM('t-radar'), spd:getM('t-spd'), rec:getM('t-rec'), con:getM('t-con'), tec:getM('t-tec'), trn:getM('t-trn'), kil:getM('t-kil'), exp:val('t-expert')*0.05+1 };
        if(d==='mon') s += (val('mon-radar')*BASE.radar*m.rad)+(val('mon-stam')*150*m.exp)+(val('mon-exp')*1000000*BASE.exp_unit*m.exp)+(val('mon-part')*BASE.drone_part*m.exp)+(val('mon-data')*1000*BASE.drone_data*m.exp);
        else if(d==='tue') s += (val('tue-truck')*BASE.truck*m.exp)+(val('tue-sec')*BASE.secret*m.exp)+(val('tue-spd')*60*BASE.spd_min*m.spd);
        else if(d==='wed') s += (val('wed-radar')*BASE.radar*m.rad)+(val('wed-spd')*60*BASE.spd_min*m.spd);
        else if(d==='thu') s += (val('thu-tkt')*BASE.recruit*m.rec)+(val('thu-ur')*BASE.ur_shard*m.exp)+(val('thu-exp')*1000000*BASE.exp_unit*m.exp);
        else if(d==='fri') s += (val('fri-radar')*BASE.radar*m.rad)+(val('fri-count')*BASE.trp[7]*m.trn);
        else if(d==='sat') s += (val('sat-kill')*BASE.kil_spec[7]*m.kil)+(val('sat-dth')*BASE.dth[7]*m.exp);
        document.getElementById('score').innerText = s.toLocaleString(undefined, {minimumFractionDigits: 1, maximumFractionDigits: 1});
        let pct = Math.min(100, (s/targetScore)*100);
        document.getElementById('bar').style.width = pct + '%';
        let diff = targetScore - s;
        document.getElementById('diff').innerText = diff > 0 ? `ë‚¨ì€ ì ìˆ˜: ${diff.toLocaleString(undefined, {maximumFractionDigits: 1})}` : "ğŸ‰ ëª©í‘œ ë‹¬ì„±!";
    }
    function getM(id) { return val('t-expert')*0.05 + val(id)*0.05 + 1; }
    window.onload = init;
</script>
</body>
</html>
