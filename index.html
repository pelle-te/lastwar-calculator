<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¼ìŠ¤íŠ¸ ì›Œ VS ë§ˆìŠ¤í„° v7.2 (LIVE)</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4f46e5; --mon: #3b82f6; --tue: #f59e0b; --wed: #8b5cf6;
            --thu: #ef4444; --fri: #10b981; --sat: #b91c1c; --bg: #f1f5f9;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #1e293b; overflow-x: hidden; }
        .nav-bar { background: #1e293b; display: flex; position: sticky; top: 0; z-index: 1000; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .nav-item { flex: 1; padding: 15px 0; text-align: center; color: #94a3b8; font-weight: 800; cursor: pointer; font-size: 0.9rem; }
        .nav-item.active { color: white; border-bottom: 3px solid var(--primary); }
        .page-content { display: none; padding: 15px; padding-bottom: 160px; animation: fadeIn 0.3s ease; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: white; border-radius: 20px; padding: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .section-title { font-size: 1rem; font-weight: 800; margin-bottom: 15px; color: var(--primary); }
        .post-textarea { width: 100%; height: 100px; border: 1px solid #ddd; border-radius: 12px; padding: 12px; box-sizing: border-box; font-size: 0.95rem; margin-bottom: 10px; resize: none; }
        .post-item { background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; margin-bottom: 12px; position: relative; }
        .post-time { font-size: 0.75rem; color: #94a3b8; margin-bottom: 6px; }
        .post-img { width: 100%; border-radius: 10px; margin-top: 10px; display: block; }
        .del-btn { position: absolute; top: 12px; right: 12px; background: #fee2e2; color: #ef4444; border: none; border-radius: 6px; padding: 6px 10px; font-size: 0.75rem; font-weight: 800; cursor: pointer; }
        .result-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; color: white; padding: 18px; border-radius: 25px 25px 0 0; text-align: center; z-index: 2000; }
        .total-score { font-size: 1.8rem; font-weight: 900; color: #fbbf24; }
        .progress-container { height: 10px; background: #334155; border-radius: 10px; margin: 8px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #10b981); width: 0%; transition: 0.5s; }
    </style>
</head>
<body>

<nav class="nav-bar">
    <div class="nav-item active" onclick="showPage('calc')">ğŸ“Š ê³„ì‚°ê¸°</div>
    <div class="nav-item" onclick="showPage('board')">ğŸ“– ê³µëµ ê³µìœ </div>
    <div class="nav-item" onclick="showPage('qna')">ğŸ’¬ ê±´ì˜ ì‚¬í•­</div>
</nav>

<div class="container" style="max-width:600px; margin: 0 auto;">
    <div id="page-calc" class="page-content active">
        <div class="card">
            <div class="section-title">ğŸ¯ ëª©í‘œ ì„¤ì •</div>
            <div style="display:flex; gap:6px;">
                <button class="target-btn" id="btn-t1" onclick="setTarget(2300000)" style="flex:1; padding:12px; border-radius:12px; border:2px solid #ddd; font-weight:800;">6ìƒ</button>
                <button class="target-btn active" id="btn-t3" onclick="setTarget(7200000)" style="flex:1; padding:12px; border-radius:12px; border:2px solid var(--primary); background:#eef2ff; color:var(--primary); font-weight:800;">9ìƒ</button>
            </div>
        </div>
        <div id="input-container"></div>
    </div>

    <div id="page-board" class="page-content">
        <div class="card">
            <div class="section-title">âœï¸ ê³µëµ ì‘ì„±</div>
            <textarea id="board-text" class="post-textarea" placeholder="ê¿€íŒì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <input type="file" id="board-file" accept="image/*" style="display:none;" onchange="updateFileName('board')">
            <div style="display:flex; gap:8px;">
                <button onclick="document.getElementById('board-file').click()" style="flex:1; padding:12px; border-radius:12px; border:1px solid #ddd; font-weight:800; cursor:pointer;">ğŸ“¸ ì‚¬ì§„</button>
                <button onclick="sendLivePost('posts')" style="flex:2; background:var(--primary); color:white; border:none; border-radius:12px; font-weight:800; cursor:pointer;">ì˜¬ë¦¬ê¸°</button>
            </div>
            <div id="board-filename" style="font-size:0.7rem; color:var(--primary); margin-top:5px; text-align:center;"></div>
        </div>
        <div id="posts-list"></div>
    </div>

    <div id="page-qna" class="page-content">
        <div class="card">
            <div class="section-title">ğŸ’¬ ê±´ì˜ ë° ë¬¸ì˜</div>
            <textarea id="qna-text" class="post-textarea" placeholder="ë¶ˆí¸í•œ ì ì„ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            <button onclick="sendLivePost('suggestions')" style="width:100%; background:#334155; color:white; padding:15px; border:none; border-radius:12px; font-weight:800; cursor:pointer;">ê±´ì˜í•˜ê¸°</button>
        </div>
        <div id="suggestions-list"></div>
    </div>
</div>

<div class="result-bar">
    <div class="total-score" id="score">0.0</div>
    <div class="progress-container"><div class="progress-fill" id="bar"></div></div>
    <div id="diff" style="font-size:0.85rem; color:#cbd5e1; font-weight:600;">ë‚¨ì€ ì ìˆ˜: 7,200,000</div>
</div>

<script>
    // 1. Firebase ì„¤ì • (ìœ ì €ë‹˜ì˜ ì •ë³´ ê·¸ëŒ€ë¡œ ìœ ì§€)
    const firebaseConfig = {
        apiKey: "AIzaSyAbGdlE4KnelSrrKGLVaLcM5433ZZILVYE",
        authDomain: "lastwar-530f9.firebaseapp.com",
        projectId: "lastwar-530f9",
        storageBucket: "lastwar-530f9.firebasestorage.app",
        messagingSenderId: "135982056229",
        appId: "1:135982056229:web:92264d4601e5315cdd50cc"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // [í•µì‹¬] ìœ ì € ID ê³ ì • ë¡œì§
    if(!localStorage.getItem('lastwar_user_id')) {
        localStorage.setItem('lastwar_user_id', 'user_' + Math.random().toString(36).substr(2, 11));
    }
    const myId = localStorage.getItem('lastwar_user_id');

    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    async function sendLivePost(col) {
        const textElem = document.getElementById(col === 'posts' ? 'board-text' : 'qna-text');
        const fileElem = col === 'posts' ? document.getElementById('board-file') : null;
        const text = textElem.value;
        if(!text.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        let imgUrl = "";
        if(fileElem && fileElem.files[0]) {
            imgUrl = await new Promise(res => {
                const r = new FileReader();
                r.onload = e => res(e.target.result);
                r.readAsDataURL(fileElem.files[0]);
            });
        }

        db.collection(col).add({
            authorId: myId, // ì‘ì„±ì ID ì €ì¥
            content: text,
            image: imgUrl,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            textElem.value = "";
            if(fileElem) { fileElem.value = ""; document.getElementById('board-filename').innerText = ""; }
        }).catch(e => alert("ì €ì¥ ì‹¤íŒ¨: " + e));
    }

    function loadLiveView(col) {
        db.collection(col).orderBy("timestamp", "desc").onSnapshot(snap => {
            const list = document.getElementById(col + '-list');
            list.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                const time = data.timestamp ? new Date(data.timestamp.seconds*1000).toLocaleString() : "ë°©ê¸ˆ ì „";
                // ì €ì¥ëœ IDì™€ í˜„ì¬ ê¸°ê¸°ì˜ IDë¥¼ ëŒ€ì¡°
                const canDelete = data.authorId === myId; 
                
                list.innerHTML += `
                    <div class="post-item">
                        <div class="post-time">${time}</div>
                        <div style="white-space:pre-wrap;">${data.content}</div>
                        ${data.image ? `<img src="${data.image}" class="post-img">` : ""}
                        ${canDelete ? `<button class="del-btn" onclick="deletePost('${col}', '${doc.id}')">ì‚­ì œ</button>` : ""}
                    </div>`;
            });
        });
    }

    function deletePost(col, docId) {
        if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db.collection(col).doc(docId).delete()
            .then(() => console.log("ì‚­ì œ ì™„ë£Œ"))
            .catch(e => alert("ì‚­ì œ ê¶Œí•œì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    function updateFileName(type) {
        const file = document.getElementById(type + '-file').files[0];
        document.getElementById(type + '-filename').innerText = file ? "ğŸ“¸ " + file.name : "";
    }

    // ì´ˆê¸° ì‹¤í–‰
    window.onload = () => {
        loadLiveView('posts');
        loadLiveView('suggestions');
        // ê³„ì‚°ê¸° ì´ˆê¸°í™” í•¨ìˆ˜ê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€
    };
</script>
</body>
</html>
