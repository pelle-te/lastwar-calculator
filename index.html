<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>라스트 워 VS 마스터</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-theme">
    <div class="header-bar">
        <div class="logo">ALLIANCE MASTER</div>
        <div class="header-actions">
            <button onclick="toggleDarkMode()" class="icon-text-btn">
                <span class="icon">🌓</span><span class="label">테마</span>
            </button>
            <div id="auto-save-status" class="icon-text-btn">
                <span class="icon">☁️</span><span class="label">저장됨</span>
            </div>
            <button onclick="showWeeklyReport()" class="icon-text-btn">
                <span class="icon">📊</span><span class="label">리포트</span>
            </button>
            <div class="lang-selector">
                <span id="lang-ko" class="active" onclick="changeLang('ko')">KO</span> | 
                <span id="lang-en" onclick="changeLang('en')">EN</span>
            </div>
            <div class="live-counter"><div class="live-dot"></div><span id="user-count">연결 중...</span></div>
        </div>
    </div>

    <nav class="nav-bar">
        <div id="nav-calc" class="nav-item active" onclick="showPage('calc')">📊 계산기</div>
        <div id="nav-board" class="nav-item" onclick="showPage('board')">💡 정보 공유</div>
    </nav>

    <div class="container">
        <div id="page-calc" class="page-content active">
            <div id="recommend-box"></div>
            
            <div class="card status-card">
                <div class="section-title">🎯 DAILY GOAL</div>
                <div class="target-selector">
                    <button class="target-btn" id="target-2300000" onclick="setTarget(2300000)">6상<br><span class="target-medal">🏅 400</span></button>
                    <button class="target-btn" id="target-3600000" onclick="setTarget(3600000)">8상<br><span class="target-medal">🏅 800</span></button>
                    <button class="target-btn active" id="target-7200000" onclick="setTarget(7200000)">9상<br><span class="target-medal">🏅 1,200</span></button>
                </div>
            </div>

            <div class="card tech-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div class="section-title" id="tech-title" style="margin-bottom:0;">🔬 ALLIANCE TECH</div>
                    <button id="tech-open-btn" onclick="openTechModal()" class="btn-primary-small">설정하기</button>
                </div>
            </div>

            <div class="day-tabs" id="day-tabs-container"></div>
            <div id="input-container"></div>
        </div>
        
        <div id="page-board" class="page-content">
            <div class="page-header-actions">
                <button onclick="openModal()" class="btn-primary" style="box-shadow: 0 4px 15px var(--primary-soft);">📝 글쓰기</button>
            </div>
            <div id="posts-list" class="masonry-grid"></div>
        </div>
    </div>

    <div class="result-bar slim-version">
        <div class="result-info">
            <div class="info-group">
                <span class="info-label" id="score-label">SCORE</span>
                <span id="score" class="info-val">0</span>
            </div>
            <div class="info-group" style="text-align: center;">
                <span class="info-label">MEDAL</span>
                <span id="medal-status" class="info-val" style="color:var(--success);">0</span>
            </div>
            <div class="info-group" style="text-align: right;">
                <span class="info-label" id="box-label">BOX</span>
                <span id="box-status" class="info-val">0 / 9</span>
            </div>
        </div>
        <div class="progress-section">
            <div class="progress-container">
                <div id="bar" class="progress-fill"></div>
                <span id="pct-text" class="progress-text">0%</span>
            </div>
            <div id="diff" class="remaining-text">남은 점수: 7,200,000</div>
        </div>
    </div>

    <div id="modal-container">
        <div id="customDialog" class="modal" style="z-index: 6000;">
            <div class="modal-card" style="max-width: 320px; text-align: center; padding: 30px 20px;">
                <h3 id="dialogTitle" style="margin-top:0; font-size:1.2rem; font-weight:800; margin-bottom: 15px;">알림</h3>
                <p id="dialogMsg" style="color: var(--text-muted); font-size:0.95rem; margin-bottom: 25px; line-height:1.4; word-break: keep-all;"></p>
                <div style="display: flex; gap: 10px;">
                    <button id="dialogBtnCancel" class="btn-secondary" style="flex:1; display:none;">취소</button>
                    <button id="dialogBtnConfirm" class="btn-primary" style="flex:1;">확인</button>
                </div>
            </div>
        </div>

        <div id="customSelectModal" class="modal bottom-sheet-modal" style="z-index: 5500;">
            <div class="bottom-sheet">
                <div class="sheet-header">
                    <h3 id="sheetTitle" style="margin:0; font-size:1.1rem;">선택</h3>
                    <span class="close-x" onclick="closeSelectModal()" style="position:static; padding:0;">&times;</span>
                </div>
                <div id="sheetOptions" class="sheet-options">
                    </div>
            </div>
        </div>

        <div id="quickInputModal" class="modal">
            <div class="modal-card" style="max-width: 400px; padding: 25px;">
                <span class="close-x" onclick="closeQuickInputModal()">&times;</span>
                <h3 style="margin-top:0; margin-bottom: 10px; font-weight: 800; display:flex; align-items:center; gap:8px;">
                    <span style="font-size:1.4rem;">⚡</span> 쾌속 입력
                </h3>
                
                <div style="margin-bottom: 15px;">
                    <label for="quick-screenshot" class="btn-secondary" style="display: block; text-align: center; padding: 12px; cursor: pointer; border-radius: 12px; font-size: 0.9rem; border: 2px dashed rgba(0,0,0,0.2);">
                        📷 인벤토리 스크린샷 불러오기
                    </label>
                    <input type="file" id="quick-screenshot" accept="image/*" style="display: none;" onchange="previewQuickScreenshot(event)">
                    
                    <div id="quick-image-preview" style="margin-top: 10px; height: 180px; overflow-y: auto; border-radius: 12px; display: none; border: 1px solid rgba(0,0,0,0.1); background: #000;">
                        <img id="quick-img-tag" style="width: 100%; display: block;">
                    </div>
                </div>

                <div id="quick-input-container" class="quick-input-grid"></div>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="closeQuickInputModal()" class="btn-secondary" style="flex:1;">취소</button>
                    <button onclick="applyQuickInput()" class="btn-primary" style="flex:2;">일괄 적용</button>
                </div>
            </div>
        </div>

        <div id="writeModal" class="modal">
            <div class="modal-card">
                <span class="close-x" onclick="closeModal()">&times;</span>
                <h3 style="margin-top:0; margin-bottom: 20px; font-weight: 800;">게시물 작성</h3>
                <input type="hidden" id="edit-doc-id">
                <div class="modern-input-wrapper">
                    <input type="text" id="post-title" class="modern-input" placeholder="제목을 입력하세요">
                </div>
                <div class="modern-input-wrapper">
                    <textarea id="post-content" class="modern-textarea" rows="6" placeholder="내용을 자세히 입력해주세요..."></textarea>
                </div>
                <div class="modern-file-wrapper">
                    <input type="file" id="post-file" accept="image/*" class="modern-file-input">
                </div>
                <button onclick="sendLivePost()" class="btn-primary" style="width:100%; margin-top: 10px;">등록하기</button>
            </div>
        </div>
        
        <div id="viewModal" class="modal"><div class="modal-card" style="max-height: 90vh; overflow-y: auto;"><span class="close-x" onclick="closeViewModal()">&times;</span><div id="view-content" style="margin-bottom: 15px;"></div><img id="view-img" style="max-width: 100%; border-radius: 16px; display: none; margin-bottom: 15px;"><div id="delete-area" style="text-align: right; margin-bottom: 15px; display: none;"><a href="#" id="edit-link" onclick="openModal(); closeViewModal();" style="color: var(--primary); font-size: 0.9rem; margin-right: 15px; font-weight:800;">수정</a><a href="#" onclick="deletePostUI()" style="color: var(--danger); font-size: 0.9rem; font-weight:800;">삭제</a></div><div style="border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px;"><h4 style="margin: 0 0 10px 0;">댓글</h4><div id="view-replies" style="max-height: 150px; overflow-y: auto; margin-bottom: 15px; font-size: 0.9rem;"></div><div style="display: flex; gap: 8px;"><input type="text" id="view-reply-input" class="modern-input" style="margin: 0; padding: 12px; flex: 1;" placeholder="댓글을 남겨보세요..."><button onclick="submitReply()" class="btn-primary" style="padding: 12px 20px; white-space: nowrap;">등록</button></div></div></div></div>
        
        <div id="weeklyModal" class="modal"><div class="modal-card"><span class="close-x" onclick="closeWeeklyModal()">&times;</span><h3 id="weekly-modal-title" style="margin-top:0">이번 주 대결 리포트 📈</h3><div id="weekly-report-content"></div><button id="weekly-close-btn" onclick="closeWeeklyModal()" class="btn-primary" style="width:100%; margin-top:20px;">닫기</button></div></div>
        <div id="techModal" class="modal"><div class="modal-card"><span class="close-x" onclick="closeTechModal()">&times;</span><h3 id="tech-modal-title" style="margin-top:0">연맹 테크 설정</h3><div class="tech-grid" id="tech-inputs"></div><button id="tech-confirm-btn" onclick="closeTechModal()" class="btn-primary" style="width:100%; margin-top:20px;">적용 완료</button></div></div>
        
        <div id="spdModal" class="modal">
            <div class="modal-card">
                <span class="close-x" onclick="closeSpdModal()">&times;</span>
                <h3 id="spd-title" style="margin-top:0; font-size:1.1rem; margin-bottom:20px;">가속 계산기</h3>
                <div class="tech-grid" id="spd-stepper-container"></div>
                <div id="spd-result-text" style="margin: 20px 0; text-align: center; color: var(--primary); font-weight: 800; font-size: 1.15rem; background: var(--primary-soft); padding: 10px; border-radius: 12px;">총: 0일 0시 0분</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px">
                    <button id="spd-cancel-btn" onclick="closeSpdModal()" class="btn-secondary">취소</button>
                    <button id="spd-apply-btn" onclick="applySpd()" class="btn-primary">적용</button>
                </div>
            </div>
        </div>

        <div id="droneModal" class="modal"><div class="modal-card"><span class="close-x" onclick="closeDroneModal()">&times;</span><h3 id="drone-modal-title" style="margin-top:0">드론 파츠 상자</h3><div class="tech-grid" id="drone-inputs-container"></div><button id="drone-confirm-btn" onclick="closeDroneModal()" class="btn-primary" style="width:100%; margin-top:20px;">확인</button></div></div>
        <div id="heroModal" class="modal"><div class="modal-card"><span class="close-x" onclick="closeHeroModal()">&times;</span><h3 id="hero-modal-title" style="margin-top:0">영웅 조각 입력</h3><div class="tech-grid" id="hero-inputs-container"></div><button id="hero-confirm-btn" onclick="closeHeroModal()" class="btn-primary" style="width:100%; margin-top:20px;">확인</button></div></div>

        <div id="lightboxModal" class="modal" style="background: rgba(0,0,0,0.95); z-index: 5000;" onclick="closeLightbox(event)">
            <span class="close-x" style="color: white; top: 20px; right: 20px; font-size: 2.5rem;">&times;</span>
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                <img id="lightbox-img" style="max-width: 100%; max-height: 100%; object-fit: contain; transition: transform 0.1s ease-out;" />
            </div>
        </div>
    </div>

    <script src="calc.js"></script>
    <script src="board.js"></script>
</body>
</html>
